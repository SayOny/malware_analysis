import requests
import json
import pefile
import hashlib
import magic
import sys

file_path = sys.argv[1]

print("====================================================")

print('파일 형식:', magic.from_file(file_path).split(' ')[0])

print("====================================================")

with open(file_path, 'rb') as f:
    binary_data = f.read()

    md5 = hashlib.md5(binary_data).hexdigest()
    sha256 = hashlib.sha256(binary_data).hexdigest()
    sha512 = hashlib.sha512(binary_data).hexdigest()

    print('해시 값')
    print('md5:', md5)
    print('sha256:', sha256)
    print('sha512:', sha512)

print("====================================================")

api_key = '0d3febfbf659acc463978e54d2875e96a304ff0e749a4b8e6ef0a52d2dd60370'
url = 'https://www.virustotal.com/vtapi/v2/file/report'
params = {'apikey': api_key, 'resource': sha256}
response = requests.get(url, params=params)
if response.status_code == 200:
    result = response.json()
    print("바이러스 토탈: ", result['positives'], '/', result['total'])

print("====================================================")

print('임포트 함수 및 DDL')

pe = pefile.PE(file_path)
for entry in pe.DIRECTORY_ENTRY_IMPORT:
    print(entry.dll.decode())
    for imp in entry.imports:
        if imp.name != None:
            print("\t{}".format(imp.name.decode()))
        else:
            print("\tord({})".format(str(imp.ordinal.decode())))

print("====================================================")

print('익스포트 함수')

if hasattr(pe, 'DIRECTORY_ENTRY_EXPORT'):
    for exp in pe.DIRECTORY_ENTRY_EXPORT.symbols:
        print(exp.name.decode())
else:
    print('익스포트 함수 없음')
